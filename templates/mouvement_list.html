{% extends 'parent.html' %}

{% block content %}
<br>
<br>

<div class="container">
    <h2>Liste des opérations</h2>

    <a href="{% url 'mouvement_add' %}" class="btn btn-primary mb-3">Ajouter un nouveau mouvement</a>

    <!-- Formulaire de filtre -->
    <form method="get" class="row g-3 mb-4">
        <div class="col-md-2">
            <label class="form-label">Mois</label>
            <select name="mois" class="form-select">
                <option value="">Tous</option>
                {% for m in MONTH_CHOICES %}
                    <option value="{{ m.0 }}" {% if mois_selected == m.0 %}selected{% endif %}>{{ m.1 }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-2">
            <label class="form-label">Sens</label>
            <select name="sens" class="form-select">
                <option value="">Tous</option>
                {% for s in SENS_CHOICES %}
                    <option value="{{ s.0 }}" {% if sens_selected == s.0 %}selected{% endif %}>{{ s.1 }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-2">
            <label class="form-label">Nature</label>
            <select name="nature" class="form-select">
                <option value="">Tous</option>
                {% for n in NATURE_CHOICES %}
                    <option value="{{ n.0 }}" {% if nature_selected == n.0 %}selected{% endif %}>{{ n.1 }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-2">
            <label class="form-label">Source</label>
            <select name="source" class="form-select">
                <option value="">Tous</option>
                {% for src in SOURCE_CHOICES %}
                    <option value="{{ src.0 }}" {% if source_selected == src.0 %}selected{% endif %}>{{ src.1 }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-2 align-self-end">
            <button type="submit" class="btn btn-success">Filtrer</button>
            <a href="{% url 'mouvement_list' %}" class="btn btn-secondary">Réinitialiser</a>
        </div>
    </form>

    <!-- Tableau des mouvements -->
    <div class="table-responsive">
        <table class="table table-striped table-bordered align-middle">
            <thead class="table-dark">
                <tr>
                    <th>Date</th>
                    <th>Mois</th>
                    <th>Année</th>
                    <th>Commune</th>
                    <th>City</th>
                    <th>Sens</th>
                    <th>Nom</th>
                    <th>Nature</th>
                    <th>Source</th>
                    <th>Bénéficiaire</th>
                    <th>Quantité</th>
                    <th>Montant</th>
                    <th>Total</th>
                    <th>Description</th>
                    <th>Commentaire</th>
                    <th>Utilisateur</th>
                </tr>
            </thead>
            <tbody>
                {% for m in mouvements %}
                <tr>
                    <td>{{ m.date|date:"d/m/Y H:i" }}</td>
                    <td>{{ m.mois }}</td>
                    <td>{{ m.annee }}</td>
                    <td>{{ m.commune }}</td>
                    <td>{{ m.city }}</td>
                    <td>{{ m.sens }}</td>
                    <td>{{ m.name }}</td>
                    <td>{{ m.nature }}</td>
                    <td>{{ m.source }}</td>
                    <td>{{ m.beneficiaire }}</td>
                    <td>{{ m.quantite }}</td>
                    <td>{{ m.montant }}</td>
                    <td>{{ m.total }}</td>
                    <td>{{ m.description }}</td>
                    <td>{{ m.commentaire }}</td>
                    <td>{{ m.user.username }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="16" class="text-center">Aucune operations trouvé</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

</div>
{% endblock %}