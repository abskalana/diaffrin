{% extends 'parent.html' %}

{% block content %}
<br>
<br>

<div class="container">
    <h2>Liste des opérations</h2>


<div class="table-responsive mt-3">
  <table class="table table-bordered text-center align-middle">
    <thead class="table-dark">
      <tr>
        <th>Réserve</th>
        <th>Caisse</th>
        <th>Activité</th>
      </tr>
    </thead>
    <tbody>
      <tr class="table-primary">
  <td>{{ somme_reserve }} FCFA </td>
  <td>{{ somme_caisse }} FCFA </td>
  <td>{{ somme_total }} FCFA </td>
</tr>
    </tbody>
  </table>
</div>

  <!-- Lien aligné à droite -->
  <div>

  </div>

<br><br>
    <!-- Formulaire de filtre -->
<form method="get" class="row g-3 mb-4">
    <div class="col-md-2">
        <label class="form-label">Année</label>
        <input type="number" name="annee" class="form-control" value="{{ year_selected|default:current_year }}">
    </div>
    <div class="col-md-2">
        <label class="form-label">Mois</label>
        <select name="mois" class="form-select">
            <option value="">Tous</option>
            {% for m in MONTH_CHOICES %}
                <option value="{{ m.0 }}" {% if mois_selected == m.0 %}selected{% endif %}>{{ m.1 }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="col-md-2">
        <label class="form-label">Sens</label>
        <select name="sens" class="form-select">
            <option value="">Tous</option>
            {% for s in SENS_CHOICES %}
                <option value="{{ s.0 }}" {% if sens_selected == s.0 %}selected{% endif %}>{{ s.1 }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="col-md-2">
        <label class="form-label">Type</label>
        <select name="type" class="form-select">
            <option value="">Tous</option>
            {% for n in TYPE_CHOICES %}
                <option value="{{ n.0 }}" {% if type_selected == n.0 %}selected{% endif %}>{{ n.1 }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="col-md-2">
        <label class="form-label">Nature</label>
        <select name="nature" class="form-select">
            <option value="">Tous</option>
            {% for n in NATURE_CHOICES %}
                <option value="{{ n.0 }}" {% if nature_selected == n.0 %}selected{% endif %}>{{ n.1 }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="col-md-2">
        <label class="form-label">Source</label>
        <select name="source" class="form-select">
            <option value="">Tous</option>
            {% for src in SOURCE_CHOICES %}
                <option value="{{ src.0 }}" {% if source_selected == src.0 %}selected{% endif %}>{{ src.1 }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="d-flex justify-content-center mt-3 gap-2">
  <button type="submit" class="btn btn-success">Filtrer</button>
  <a href="{% url 'mouvement_list' %}" class="btn btn-secondary">Réinitialiser</a>
  <a href="{% url 'mouvement_add' %}" class="btn btn-primary">
    ➕ Ajouter une opération
  </a>
</div>

</form>


    <!-- Tableau des mouvements -->
    <div class="table-responsive">
        <table class="table table-striped table-bordered align-middle">
            <thead class="table-dark">
                <tr>
                    <th>Date effet</th>
                    <th>Mois</th>
                    <th>Année</th>
                    <th>City</th>
                    <th>Sens</th>
                    <th>Nom</th>
                    <th>Nature</th>
                    <th>Source</th>
                    <th>Type</th>
                    <th>Quantité</th>
                    <th>Montant </th>
                    <th>Total</th>
                    <th>Commentaire</th>
                    <th>User</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody>
    {% for m in mouvements %}
    <tr
        {% if m.sens == "entree" %} style="background-color:#3ae374;"
        {% elif m.sens == "depot" %} style="background-color:#18dcff;"
        {% elif m.sens == "retrait" %} style="background-color:#ffaf40;"
        {% endif %}
    >
        <td>{{ m.date|date:"d/m/Y" }}</td>
        <td>{{ m.mois }}</td>
        <td>{{ m.annee }}</td>
        <td>{{ m.city }}</td>
        <td>{{ m.sens }}</td>
        <td>{{ m.name }}</td>
        <td>{{ m.nature }}</td>
        <td>{{ m.source }}</td>
        <td>{{ m.category }}</td>
        <td>{{ m.quantite }}</td>
        <td>{{ m.montant }}</td>
        <td {% if m.total < 0 %} style="color: red;"{% endif %}>
               {{ m.total }}
        </td>
        <td>{{ m.commentaire }}</td>
        <td>{{ m.user.username }}</td>
        <td>{{ m.date_created|date:"d/m/Y H\hi" }}</td>
    </tr>
    {% empty %}
    <tr>
        <td colspan="16" class="text-center">Aucune opérations trouvée</td>
    </tr>
    {% endfor %}
</tbody>
        </table>
    </div>
</div>

</div>
{% endblock %}