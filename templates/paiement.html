{% extends 'parent.html' %}

{% block content %}

<h2>Historique paiement</h2>
<br><br>
<form method="get" class="d-flex justify-content-center align-items-center mb-3 flex-wrap">
   <div class="me-2 mb-2">
    <input type="number" class="form-control" name="annee" id="annee" value="{{ annee }}" placeholder="Année">
</div>

<div class="me-2 mb-2">
    <select class="form-control" name="mois" id="mois">
        <option value="">-- Tous --</option>
        {% for key, label in MONTH_CHOICES %}
            <option value="{{ key }}" {% if mois == key %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
    </select>
</div>

<div class="me-2 mb-2">
    <select class="form-control" name="status" id="status">
        <option value="">-- Tous --</option>
        {% for key, label in STATUS_CHOICES %}
            <option value="{{ key }}" {% if status == key %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
    </select>
</div>

<div class="me-2 mb-2">
    <select class="form-control" name="ticket_type" id="ticket_type">
        <option value="">-- Tous --</option>
        {% for key, label in TYPE_TICKET %}
            <option value="{{ key }}" {% if ticket_type == key %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
    </select>
</div>

<!-- Nouveau champ Nom -->
<div class="me-2 mb-2">
    <input type="text" class="form-control" name="nom" id="nom" value="{{ request.nom }}" placeholder="Nom">
</div>

<!-- Nouveau champ Téléphone -->
<div class="me-2 mb-2">
    <input type="text" class="form-control"   pattern="\d{8}" name="telephone" id="telephone" value="{{ request.telephone }}" placeholder="Téléphone">
</div>


    <!-- Boutons alignés avec les inputs -->
    <div class="d-flex mb-2">
        <button type="submit" class="btn btn-primary me-2">Filtrer</button>
        <button type="submit" name="download" value="excel" class="btn btn-success me-2">Télécharger Excel</button>
        <button type="submit" name="download" value="pdf" class="btn btn-info me-2">Télécharger PDF</button>
        <a href="{% url 'paiement-list' %}" class="btn btn-secondary">Réinitialiser</a>
    </div>
</form>



<br><br>
   <div class="table-responsive">
    <table class="table table-striped table-bordered table-hover">
        <thead class="table-dark">
            <tr>
                 <th>#</th>
                <th>Ville</th>
                <th>Localité</th>
                <th>Activité</th>
                <th>Type</th>
                <th>Propriété</th>
                <th>Nom Contact</th>
                <th>Prénom Contact</th>
                <th>Téléphone</th>
                <th>Porte</th>
                <th>Mois</th>
                <th>Valeur Paiement</th>
                <th>Status Paiement</th>
                <th>Date Paiement</th>
            </tr>
        </thead>
        <tbody>
            {% for paiement in paiements %}
                <tr>
                     <td>{{ forloop.counter }}</td>
                    <td>{{ paiement.entity_model.city }}</td>
                    <td>{{ paiement.entity_model.locality }}</td>
                    <td>{{ paiement.entity_model.activity }}</td>
                    <td>{{ paiement.entity_model.type_entity }}</td>
                    <td>{{ paiement.entity_model.property }}</td>
                    <td>{{ paiement.entity_model.contact_nom }}</td>
                    <td>{{ paiement.entity_model.contact_prenom }}</td>


                          <td>
    {% if paiement.entity_model.contact_phone|length == 8 %}
        {{ paiement.entity_model.contact_phone }}
    {% else %}
        ---
    {% endif %}
</td>

                    <td>{{ paiement.entity_model.porte }}</td>
                    <td>{{ paiement.mois }} {{ paiement.annee }}</td>
                    <td>{{ paiement.value }}</td>
                    <td>{{ paiement.status }}</td>
                    <td>{{ paiement.date_created|date:"d/m/Y H\hi"  }}</td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="15" class="text-center">Aucun paiement trouvé</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}